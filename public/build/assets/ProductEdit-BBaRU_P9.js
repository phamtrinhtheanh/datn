import{d as R,G as X,c as D,r as P,x as Y,a as d,o as l,b as n,u as t,g as Z,w as a,e as i,W as b,f as c,l as T,i as g,t as _,F as h,j as k,h as F,H as ee,I as te,p as V,J as se,K as re,L as oe}from"./app-Cdi_seLk.js";import{_ as C}from"./index-Bi_qipny.js";import{_ as I}from"./Checkbox.vue_vue_type_script_setup_true_lang-N-rnviLB.js";import{_ as y}from"./Input.vue_vue_type_script_setup_true_lang-B-IRVU7u.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-hFIdDLsU.js";import{_ as E,a as q,b as B,c as z,d as H}from"./SelectValue.vue_vue_type_script_setup_true_lang-C3bAROUO.js";import{_ as ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-IF2V6vrE.js";import{u as ne,Q as ae}from"./vue-quill.snow-BHDzW2X7.js";import"./useForwardPropsEmits-CcLnhiEM.js";import"./useForwardExpose-BEz30n0G.js";import"./check-BP9UBmzw.js";import"./createLucideIcon-Dvgbo__P.js";import"./useFormControl-BtsRjYEG.js";import"./Collection-DZ2PJz9c.js";import"./usePrimitiveElement-Bl6t-gbd.js";import"./RovingFocusGroup-BUD0FIFP.js";import"./VisuallyHiddenInput-Cwoffclv.js";import"./VisuallyHidden-fcAHhEpi.js";import"./DialogPortal-DyU5Youu.js";import"./useFocusGuards-DPvUNzkk.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DwzU_E9u.js";import"./DropdownMenuTrigger.vue_vue_type_script_setup_true_lang-DbaRmOJN.js";import"./x-Chvp1jPq.js";import"./shopping-cart-UQFKnvAk.js";import"./Sonner.vue_vue_type_script_setup_true_lang-ebLjZvkU.js";import"./vue-sonner-CwCT7mN6.js";const le={class:"container mx-auto py-6"},de={class:"mb-6 flex items-start justify-between"},pe={class:"bg-card container rounded-lg border p-6 shadow-sm",id:"form-tb"},ue={class:"grid grid-cols-2 gap-6"},ce={class:"gap-4 space-y-4"},me={class:"col-span-4 space-y-2"},_e={key:0,class:"text-sm text-red-500"},fe={class:"grid grid-cols-2 gap-4"},ge={key:0,class:"text-sm text-red-500"},ve={key:0,class:"text-sm text-red-500"},he={class:"space-y-2"},ye={class:"space-y-2"},be={key:0,class:"text-sm text-red-500"},ke={class:"col-span-2 flex items-end space-x-2"},xe={class:"col-span-2 flex items-end space-x-2"},we={class:"grid grid-cols-4 gap-4"},Ve={class:"space-y-2"},Ce={key:0,class:"text-sm text-red-500"},Me={class:"space-y-2"},$e={key:0,class:"text-sm text-red-500"},Se={class:"space-y-2"},Ue={key:0,class:"text-sm text-red-500"},Ne={class:"space-y-2"},je={key:0,class:"text-sm text-red-500"},De={class:"space-y-2"},Pe={class:"space-y-4"},Te={class:"grid grid-cols-4 gap-4"},Fe={class:"group relative col-span-3 aspect-square"},Ie={key:0,class:"relative h-full w-full"},Ee=["src"],qe={key:0,class:"text-sm text-gray-500"},Be={key:1,class:"text-sm text-gray-500"},ze={class:"space-y-4"},He=["onClick"],Le=["src"],Oe=["onClick"],Ge={key:0,class:"text-sm text-red-500"},Je={class:"col-span-full w-full space-y-2"},Ke={key:0,class:"text-sm text-red-500"},Qe={class:"flex justify-end gap-4"},kt=R({__name:"ProductEdit",props:{product:{type:Object,required:!0}},setup(L){const u=L,M=X(),O=D(()=>{var o;return((o=M.props.brands)==null?void 0:o.data)||[]}),G=D(()=>{var o;return((o=M.props.categories)==null?void 0:o.data)||[]});P(!1);const m=P([]);if(u.product.images){const o=typeof u.product.images=="string"?JSON.parse(u.product.images):u.product.images;m.value=o.map((e,p)=>({id:Math.random().toString(36).substr(2,9),url:e,isMain:p===0}))}const s=Y({name:u.product.name||"",description:u.product.description||"",price:u.product.price||0,line_price:u.product.line_price||0,import_price:u.product.import_price||0,stock:u.product.stock||0,images:[],is_featured:u.product.is_featured||!1,is_active:u.product.is_active||!0,brand_id:u.product.brand_id||"",category_id:u.product.category_id||"",specs:typeof u.product.specs=="string"?u.product.specs:JSON.stringify(u.product.specs,null,2),_method:"PUT"});async function J(o){const e=new FormData;e.append("file",o);try{return(await oe.post(route("admin.upload"),e,{headers:{"Content-Type":"multipart/form-data"}})).data.url}catch(p){throw console.error("Upload failed:",p),p}}async function $(o,e){if(s.images.length+o.length>4){alert("Chỉ được upload tối đa 4 ảnh");return}const p=o.filter(r=>r.size>5*1024*1024?(alert(`File ${r.name} vượt quá kích thước cho phép (5MB)`),!1):r.type.startsWith("image/")?!0:(alert(`File ${r.name} không phải là file ảnh`),!1));for(const r of p)try{const v=await J(r);s.images.push(v);const x={id:Math.random().toString(36).substr(2,9),url:v,isMain:m.value.length===0};m.value.push(x)}catch{alert(`Không thể upload file ${r.name}`)}e.length>0&&console.log("Rejected files:",e)}const{getRootProps:S,getInputProps:U,isDragActive:K}=ne({onDrop:$,accept:["image/*"],maxFiles:4,maxSize:5*1024*1024,noClick:!0}),N=()=>{const o=document.createElement("input");o.type="file",o.accept="image/*",o.multiple=!0,o.onchange=async e=>{const p=e.target.files;p&&await $(Array.from(p),[])},o.click()},j=o=>{s.images.splice(o,1),m.value.splice(o,1),m.value.length>0&&!m.value.some(e=>e.isMain)&&(m.value[0].isMain=!0)},Q=o=>{m.value.forEach((e,p)=>{e.isMain=p===o})},W=()=>{const o=new FormData;o.append("name",s.name),o.append("description",s.description),o.append("price",s.price.toString()),o.append("line_price",s.line_price.toString()),o.append("import_price",s.import_price.toString()),o.append("stock",s.stock.toString()),o.append("is_featured",s.is_featured?"1":"0"),o.append("is_active",s.is_active?"1":"0"),o.append("brand_id",s.brand_id),o.append("category_id",s.category_id),o.append("specs",s.specs),o.append("_method","PUT"),s.images.forEach((e,p)=>{o.append(`images[${p}]`,e),m.value[p].isMain&&o.append("main_image_index",p.toString())}),b.post(route("admin.products.update",u.product.id),o,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{b.visit(route("admin.products.index"))},onError:e=>{console.error("Upload failed:",e)}})},A={theme:"snow",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]}};return(o,e)=>(l(),d(h,null,[n(t(Z),{title:"Edit Product"}),n(ie,null,{default:a(()=>{var p;return[i("div",le,[i("div",de,[e[15]||(e[15]=i("h1",{class:"mb-4 text-3xl font-extrabold"},"Chỉnh sửa sản phẩm",-1)),n(t(C),{variant:"outline",onClick:e[0]||(e[0]=r=>t(b).visit(o.route("admin.products.index")))},{default:a(()=>e[14]||(e[14]=[c("Quay lại")])),_:1,__:[14]})]),i("div",pe,[i("form",{onSubmit:T(W,["prevent"]),class:"space-y-6"},[i("div",ue,[i("div",ce,[i("div",me,[n(t(f),{for:"name"},{default:a(()=>e[16]||(e[16]=[c("Tên sản phẩm")])),_:1,__:[16]}),n(t(y),{id:"name",modelValue:t(s).name,"onUpdate:modelValue":e[1]||(e[1]=r=>t(s).name=r),placeholder:"Nhập tên sản phẩm"},null,8,["modelValue"]),t(s).errors.name?(l(),d("p",_e,_(t(s).errors.name),1)):g("",!0)]),i("div",fe,[i("div",null,[n(t(f),{for:"brand_id",class:"mb-2"},{default:a(()=>e[17]||(e[17]=[c("Thương hiệu")])),_:1,__:[17]}),n(t(E),{modelValue:t(s).brand_id,"onUpdate:modelValue":e[2]||(e[2]=r=>t(s).brand_id=r),class:"w-0"},{default:a(()=>[n(t(q),{class:"w-full"},{default:a(()=>[n(t(B),{placeholder:"Chọn thương hiệu"})]),_:1}),n(t(z),null,{default:a(()=>[(l(!0),d(h,null,k(O.value,r=>(l(),F(t(H),{key:r.id,value:r.id},{default:a(()=>[c(_(r.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(s).errors.brand_id?(l(),d("p",ge,_(t(s).errors.brand_id),1)):g("",!0)]),i("div",null,[n(t(f),{for:"category_id",class:"mb-2"},{default:a(()=>e[18]||(e[18]=[c("Danh mục")])),_:1,__:[18]}),n(t(E),{modelValue:t(s).category_id,"onUpdate:modelValue":e[3]||(e[3]=r=>t(s).category_id=r),class:"w-0"},{default:a(()=>[n(t(q),{class:"w-full"},{default:a(()=>[n(t(B),{placeholder:"Chọn danh mục"})]),_:1}),n(t(z),null,{default:a(()=>[(l(!0),d(h,null,k(G.value,r=>(l(),F(t(H),{key:r.id,value:r.id},{default:a(()=>[c(_(r.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),t(s).errors.category_id?(l(),d("p",ve,_(t(s).errors.category_id),1)):g("",!0)])]),i("div",he,[n(t(f),null,{default:a(()=>e[19]||(e[19]=[c("Thông số kỹ thuật")])),_:1,__:[19]}),i("div",ye,[ee(i("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>t(s).specs=r),class:"w-full rounded-md border border-gray-300 p-2 font-mono text-sm",rows:"10",placeholder:`{
  "key1": "value1",
  "key2": "value2"
}`},null,512),[[te,t(s).specs]]),e[20]||(e[20]=i("p",{class:"text-sm text-gray-500"},"Nhập thông số kỹ thuật theo định dạng JSON",-1)),t(s).errors.specs?(l(),d("p",be,_(t(s).errors.specs),1)):g("",!0)])]),i("div",ke,[n(t(I),{id:"is_feature",modelValue:t(s).is_featured,"onUpdate:modelValue":e[5]||(e[5]=r=>t(s).is_featured=r)},null,8,["modelValue"]),n(t(f),{for:"is_feature"},{default:a(()=>e[21]||(e[21]=[c("Sản phẩm nổi bật")])),_:1,__:[21]})]),i("div",xe,[n(t(I),{id:"is_feature",modelValue:t(s).is_active,"onUpdate:modelValue":e[6]||(e[6]=r=>t(s).is_active=r)},null,8,["modelValue"]),n(t(f),{for:"is_feature"},{default:a(()=>e[22]||(e[22]=[c("Hoạt động")])),_:1,__:[22]})]),i("div",we,[i("div",Ve,[n(t(f),{for:"import_price"},{default:a(()=>e[23]||(e[23]=[c("Giá nhập")])),_:1,__:[23]}),n(t(y),{id:"import_price",type:"number",modelValue:t(s).import_price,"onUpdate:modelValue":e[7]||(e[7]=r=>t(s).import_price=r),placeholder:"Nhập giá nhập (nghìn đồng)"},null,8,["modelValue"]),t(s).errors.import_price?(l(),d("p",Ce,_(t(s).errors.import_price),1)):g("",!0)]),i("div",Me,[n(t(f),{for:"line_price"},{default:a(()=>e[24]||(e[24]=[c("Giá niêm yết")])),_:1,__:[24]}),n(t(y),{id:"line_price",type:"number",modelValue:t(s).line_price,"onUpdate:modelValue":e[8]||(e[8]=r=>t(s).line_price=r),placeholder:"Nhập giá niêm yết (nghìn đồng)"},null,8,["modelValue"]),t(s).errors.line_price?(l(),d("p",$e,_(t(s).errors.line_price),1)):g("",!0)]),i("div",Se,[n(t(f),{for:"price"},{default:a(()=>e[25]||(e[25]=[c("Giá bán")])),_:1,__:[25]}),n(t(y),{id:"price",type:"number",modelValue:t(s).price,"onUpdate:modelValue":e[9]||(e[9]=r=>t(s).price=r),placeholder:"Nhập giá bán (nghìn đồng)"},null,8,["modelValue"]),t(s).errors.price?(l(),d("p",Ue,_(t(s).errors.price),1)):g("",!0)]),i("div",Ne,[n(t(f),{for:"stock"},{default:a(()=>e[26]||(e[26]=[c("Số lượng")])),_:1,__:[26]}),n(t(y),{id:"stock",type:"number",modelValue:t(s).stock,"onUpdate:modelValue":e[10]||(e[10]=r=>t(s).stock=r),placeholder:"Nhập số lượng"},null,8,["modelValue"]),t(s).errors.stock?(l(),d("p",je,_(t(s).errors.stock),1)):g("",!0)])])]),i("div",De,[n(t(f),{for:"images"},{default:a(()=>e[27]||(e[27]=[c("Hình ảnh sản phẩm")])),_:1,__:[27]}),i("div",Pe,[i("div",Te,[i("div",Fe,[m.value.length>0?(l(),d("div",Ie,[i("img",{src:(p=m.value.find(r=>r.isMain))==null?void 0:p.url,alt:"Main preview",class:"h-full w-full rounded-lg border object-cover"},null,8,Ee),i("button",{type:"button",class:"absolute top-2 right-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity group-hover:opacity-100",onClick:e[11]||(e[11]=r=>j(m.value.findIndex(v=>v.isMain)))}," × ")])):(l(),d("div",V({key:1},t(S)(),{onClick:N,class:"flex h-full w-full cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed bg-gray-50 transition-colors hover:bg-gray-100"}),[i("input",se(re(t(U)())),null,16),e[28]||(e[28]=i("svg",{class:"mb-2 h-8 w-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),t(K)?(l(),d("p",qe,"Thả ảnh vào đây...")):(l(),d("p",Be,"Kéo thả ảnh vào đây hoặc click để chọn"))],16))]),i("div",ze,[(l(!0),d(h,null,k(m.value.filter(r=>!r.isMain).slice(0,3),(r,v)=>(l(),d("div",{key:r.id,class:"group relative aspect-square cursor-pointer",onClick:x=>Q(m.value.findIndex(w=>w.id===r.id))},[i("img",{src:r.url,alt:"Preview",class:"h-full w-full rounded-lg border object-cover"},null,8,Le),i("button",{type:"button",class:"absolute top-2 right-2 flex h-6 w-6 items-center justify-center rounded-full bg-red-500 text-white opacity-0 transition-opacity group-hover:opacity-100",onClick:T(x=>j(m.value.findIndex(w=>w.id===r.id)),["stop"])}," × ",8,Oe)],8,He))),128)),(l(!0),d(h,null,k(3-m.value.filter(r=>!r.isMain).length,r=>(l(),d("div",V({key:r},{ref_for:!0},t(S)(),{onClick:N,class:"flex aspect-square cursor-pointer items-center justify-center rounded-lg border-2 border-dashed bg-gray-50 transition-colors hover:bg-gray-100"}),[i("input",V({ref_for:!0},t(U)()),null,16),e[29]||(e[29]=i("svg",{class:"h-6 w-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1))],16))),128))])]),t(s).errors.images?(l(),d("p",Ge,_(t(s).errors.images),1)):g("",!0)])]),i("div",Je,[n(t(f),{for:"description"},{default:a(()=>e[30]||(e[30]=[c("Mô tả")])),_:1,__:[30]}),n(t(ae),{content:t(s).description,"onUpdate:content":e[12]||(e[12]=r=>t(s).description=r),options:A,contentType:"html",class:"quill-full-width"},null,8,["content"]),t(s).errors.description?(l(),d("p",Ke,_(t(s).errors.description),1)):g("",!0)])]),i("div",Qe,[n(t(C),{variant:"outline",type:"button",onClick:e[13]||(e[13]=r=>t(b).visit(o.route("admin.products.index")))},{default:a(()=>e[31]||(e[31]=[c("Hủy")])),_:1,__:[31]}),n(t(C),{type:"submit",disabled:t(s).processing},{default:a(()=>e[32]||(e[32]=[c("Lưu thay đổi")])),_:1,__:[32]},8,["disabled"])])],32)])])]}),_:1})],64))}});export{kt as default};
